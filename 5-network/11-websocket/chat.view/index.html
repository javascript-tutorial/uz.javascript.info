<!DOCTYPE html>
<form name="publish">
  <input type="text" name="message" maxlength="50" />
  <input type="submit" value="Yuborish" />
</form>

<div id="messages"></div>

<script>
  let url =
    location.host == "localhost"
      ? "ws://localhost:8080/ws"
      : location.host == "javascript.local"
      ? `ws://javascript.local/article/websocket/chat/ws` // mahalliy sayt bilan dev integratsiyasi
      : `wss://javascript.info/article/websocket/chat/ws`; // javascript.info bilan mahsulot integratsiyasi

  let socket = new WebSocket(url);

  // shakldan xabar yuboring
  document.forms.publish.onsubmit = function () {
    let outgoingMessage = this.message.value;

    socket.send(outgoingMessage);
    return false;
  };

  // kiruvchi xabarlarni boshqarish
  socket.onmessage = function (event) {
    let incomingMessage = event.data;
    showMessage(incomingMessage);
  };

  socket.onclose = (event) => console.log(`${event.code} bilan yopildi`);

  // xabarni div#messages-da ko'rsatish
  function showMessage(message) {
    let messageElem = document.createElement("div");
    messageElem.textContent = message;
    document.getElementById("messages").prepend(messageElem);
  }
</script>
